```
问题1：设备借用流程测试覆盖面不足
    当前仅有 2 个集成用例（主流程闭环 + 管理员标记逾期），核心 happy path 已验证，但异常分支和边缘场景尚未覆盖。
```
`测试记录\0501Test Results - EquipmentBorrowControllerTest.html`

补充建议用例（待实现）：

- **失败/异常场景**
  - 借用数量超过设备可用数量时，应返回 400 且提示“借用数量不能超过设备可用数量”
  - 传入不存在的设备 ID 借用，应返回 404 “设备不存在”
  - 标记逾期前，若借用记录在计划归还时间前已归还，则不应被标记为“已逾期”

- **权限相关场景**
  - 学生/教师调用 `PUT /api/v1/borrow/{id}/approve`（审批接口）应被拒绝（403）
  - 非管理员用户调用 `PUT /api/v1/borrow/mark-overdue`（标记逾期接口）应被拒绝（403）

- **并发/冲突场景（可按顺序近似模拟）**
  - 对同一设备创建多笔“待审批”的借用请求，并依次审批+借出，验证任何时刻 `sum(已借出数量 + 新申请数量)` 不超过设备总数量

- **时间边界场景**
  - 借用请求中，借用日期早于当前时间：根据业务规则确认是否允许（目前后端未限制），需要在文档中明确并考虑是否增加校验
  - 借用请求中，计划归还时间等于借用时间或比借用时间早：应返回 400（当前部分校验已实现，但缺乏针对性的测试用例）

---

```
问题2：更新后的借用模块测试（0502）出现 3 个失败用例（7 total, 3 failed）
```
`测试记录\0502Test Results - EquipmentBorrowControllerTest.html`

### 失败1：审批拒绝用例断言字段名不一致

- **失败用例**：`管理员审批拒绝：应该将状态改为已拒绝`
- **现象**：断言 `$.data.remark` 不存在（PathNotFound）
- **原因**：后端响应字段为 `approveRemark`（与表字段 `approve_remark` 一致），并没有 `remark` 字段。
- **建议**
  - 测试中将 `jsonPath("$.data.remark")` 改为 `jsonPath("$.data.approveRemark")`；
  - 或者若前端强依赖 `remark` 字段，需要在响应 DTO 增加别名字段（不推荐，建议统一用 `approveRemark`）。

### 失败2：无效参数用例的预期与后端当前规则不一致

- **失败用例**：`无效参数测试：各种错误参数场景`
- **现象**：部分场景期望 400，但实际返回 200（例如 quantity=-1 / quantity=0 / purpose=""）
- **原因（后端当前实现）**
  - `quantity` 小于 1 时会被后端“容错”归一为 1（未抛错）；
  - `purpose` 目前未设置必填校验（为空也允许）；
  - `equipmentId` 不存在时，后端返回 404 “设备不存在”（而不是 400）。
- **建议（二选一，需明确业务规则后统一）**
  - **按当前后端容错策略修测试**：把 quantity=-1/0、purpose="" 的断言改成 200；把 equipmentId 不存在的断言改成 404；
  - **按更严格的规则修后端**：在 `CreateBorrowRequest` 增加校验（例如 quantity>=1、purpose 非空），并在 service 中对 quantity<=0 直接抛 400。

### 失败3：权限用例期望状态码与后端实现不一致

- **失败用例**：`权限测试：学生只能查看自己的借用记录`
- **现象**：测试期望 404，但实际返回 403，响应消息为“无权限查看该借用记录详情”
- **原因**：后端采用“明确拒绝”的策略：非管理员访问他人借用记录直接 403，而不是隐藏资源返回 404。
- **建议**
  - 测试改为 `andExpect(status().isForbidden())`；
  - 或者如果产品希望“隐藏资源”（避免枚举），则后端改为对非本人返回 404（需要全局统一策略）。


